---
title: 'Assignment 4, Task 3: Mini exploratory report on juvenile snowshoe hares in
  Bonanza Creek LTER'
author: "Katie Pietrucha"
date: "11/7/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# Attach packages
library(tidyverse)
library(effsize)
library(broom)
library(here)
library(kableExtra)
library(lubridate)
```

```{r, include = FALSE}
# Read in the data
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```

## Introduction

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report.

## Data and analyses

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

## Juvenile hare initial investigation 

### Annual juvenile hare trap counts 

Count the total number of juvenile hare trappings during each year of the study, and create a finalized data visualization of the counts by year. Include a figure caption below the figure in your report. 

```{r, include = FALSE}
# Wrangle to find total number of hare trappings per year

hare_counts <- bonanza_hares %>% 
  filter(age == "j") %>%
  mutate(date_new = mdy(date)) %>%
  mutate(year = year(date_new)) %>%
  group_by(year) %>%
  summarize(count = n()) 
```

```{r, include = FALSE}
# Summary Stats
hare_count_stats <- hare_counts %>%
  summarize(mean = round(mean(count), 2),
            max = max(count),
            min = min(count),
            median = median(count),
            sd = sd(count))
```

```{r, include = TRUE}
# Visualize hare trappings per year

hare_counts %>%
  ggplot(aes(x = year, y = count)) +
  geom_col(fill = "cadetblue3") +
  scale_x_continuous(breaks = 1999:2012) +
  scale_y_continuous(breaks = seq(0, 150, by = 25)) +
  labs(x = "\nYear", y = "Number of juvenile hare trappings\n") +
  theme_bw()
```

**Figure 1:** Total number of juvenile hare trappings by year (1999-2012).

Then, in 3 - 4 sentences below your figure, describe major takeaways from your graph about total snowshoe hare trappings at the site. You might consider:

What were the minimum and maximum counts of juvenile hare trappings?
Mean or median annual number of juvenile hares trapped?
General/notable trends?
These are absolute counts, but this count is also impacted by effort (e.g. the number of days and number of traps in the study each year). What would you suggest be done moving forward (you are not expected to actually do this) to standardize the juvenile hare population in future analyses?

### Visualize juvenile hare weights

Create a finalized data visualization (or visualizations) in which you compare **juvenile hare weights by sex and site (grid)** (ignore other variables). You should include groups where these variables are not recorded (`NA`). Include finalized figure captions below your visualization(s).

```{r, include = FALSE}
# Wrangle juvenile hare weights by sex and site

hare_weights <- bonanza_hares %>%
  filter(age == "j") %>%
    mutate(grid_full = case_when(
    grid == "bonrip" ~ "Bonanza Riparian",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonbs" ~ "Mature Lowland Black Spruce")) %>%
  drop_na(weight) %>%
  group_by(sex, weight, grid_full) %>%
  summarize()
```

```{r, include = TRUE}
# Visualize juvenile hare weights
hare_weights %>%
  ggplot(aes(x = sex, y = weight, fill = sex)) +
  geom_jitter(aes(color = sex)) + 
  geom_boxplot(alpha = 0.7, fill = NA) +
  facet_wrap(~ grid_full) +
  scale_color_manual(values = c("lightcoral", "darkseagreen3", "grey")) +
  stat_summary(fun.y = mean, geom = "point", shape = 20, size = 4 , color = "black") + 
  theme_bw() +
  labs(x = "\nSex", y = "Hare weight (grams)\n") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Female","Male","N/A"))
```

**Figure 2:** Insert caption here

Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures.

Note: There are multiple ways to visualize these comparisons. We encourage you to think carefully then make decisions about how to visualize these comparisons, including:

Can I use faceting to simplify the comparisons into manageable pieces?
Am I showing the audience the data, summary statistics, or both?
Have I updated graph labels, headers in facets, etc. to make it as straightforward as possible for viewers?
Have I simplified and finalized my data visualization(s) to include components that are useful for the audience?

### Juvenile weight comparison 

Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. In this section, you should include:

A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares, with a table caption (remember, a table caption should be placed *above* the table in your report)

```{r, include = FALSE}
# Summary statistics for weights

weight_stats <- hare_weights %>%
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male")) %>%
  group_by(sex) %>%
  drop_na(sex) %>%
  summarize(mean = round(mean(weight, na.rm = TRUE), 2),
            sd = round(sd(weight, na.rm = TRUE), 2),
            sample_size = n())
```

```{r, include = FALSE}
# Visualize data exploration with histograms and Q-Q plots

ggplot(data = hare_weights, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~ sex)

ggplot(data = hare_weights, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex)
```

```{r, include = FALSE}
# Split into groups for t-test

female_sample <- hare_weights %>% 
  filter(sex == "f") %>% 
  drop_na(weight) %>%
  pull(weight)

male_sample <- hare_weights %>% 
  filter(sex == "m") %>% 
  drop_na(weight) %>%
  pull(weight)
```

```{r, include = FALSE}
# Perform t-test

weight_t <- t.test(male_sample, female_sample)

weight_t
```

```{r, include = FALSE}
# Cohen's d

weight_cohen <- cohen.d(male_sample, female_sample)

weight_cohen
```

```{r, include = TRUE}
# Create table

  kbl(weight_stats, caption = "<center><strong>Table 1: Summary Statistics </strong>: Insert caption here</center>", col.names = c("Sex", "Mean (g)", "Standard Deviation (g)", "Sample Size")) %>%
  kable_paper(full_width = F) %>%
  kable_styling(bootstrap_options = c("striped", "hover")) 
```


A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test
 
Note: Exploratory graphs (e.g. histograms, QQ-plots) to explore assumptions of your t-test should not show up in your final knitted document, but you DO still need to create and think about them to determine whether a t-test is appropriate. If you want keep the code chunk containing those exploratory visualizations in your .Rmd but not appear in the knitted doc, you can add `include = FALSE` in the code chunk header.

### Relationship between juvenile weight & hind foot length

Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

```{r, include = FALSE}
# Filter data for all juvenile hares

juve_hares <- bonanza_hares %>%
  filter(age == "j") 
```

```{r, include = TRUE}
# Compare juvenile hare hind foot length and weight

juve_hares %>%
  ggplot(aes(x = weight, y = hindft)) +
  geom_point(color = "cadetblue3") +
  labs(x = "\nJuvenile hare weight (grams)", y = "Hind foot length (mm)\n") +
  theme_bw() 
  
```

**Figure 3:** Insert caption here.

Upon seeing your graph, your “boss” tells you to try out linear regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. Try it out (the only variables you are expected to include here are hind foot length and weight, using data for all juvenile hares in the data, e.g. you are not expected to explore impacts of sex, site, etc.), and check the model diagnostics.

```{r, include = FALSE}
# Linear regression

hare_lm <- lm(weight ~ hindft, data = juve_hares)

hare_lm_tidy <- tidy(hare_lm)

hare_lm_tidy
```

```{r, include = FALSE}
# Pearson's r

hares_cor <- cor.test(juve_hares$weight, juve_hares$hindft)

hares_cor_tidy <- tidy(hares_cor)

hares_cor_tidy
```


```{r, include = FALSE}
# Check model diagnostics

plot(hare_lm)
```

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

## Summary

Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)

## Citations

**Data citation:** Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

