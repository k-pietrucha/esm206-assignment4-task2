---
title: 'Assignment 4, Task 3: Mini exploratory report on juvenile snowshoe hares in
  Bonanza Creek LTER'
author: "Katie Pietrucha"
date: "11/7/2021"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# Attach packages
library(tidyverse)
library(effsize)
library(broom)
library(here)
library(kableExtra)
library(lubridate)
```

```{r, include = FALSE}
# Read in the data
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```

## Introduction

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report.

## Data and analyses

Bonanza Creek LTER is part of the US Long Term Ecological Research Network. See more information about the site here. In this “mini exploratory report,” you will explore the counts and sizes of juvenile snowshoe hares recorded from 1998 - 2012.
A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

## Juvenile hare initial investigation 

### Annual juvenile hare trap counts 

```{r, include = FALSE}

# Wrangle to find total number of juvenile hare trappings per year
hare_counts <- bonanza_hares %>% 
  filter(age == "j") %>%
  mutate(date_new = mdy(date)) %>%
  mutate(year = year(date_new)) %>%
  group_by(year) %>%
  summarize(count = n()) 
```

```{r, include = FALSE}

# Summary statistics for hare counts
hare_count_stats <- hare_counts %>%
  summarize(mean = round(mean(count), 2),
            max = max(count),
            min = min(count),
            median = median(count),
            sd = sd(count))
```

```{r, include = TRUE}

# Visualize juvenile hare trappings per year
hare_counts %>%
  ggplot(aes(x = year, y = count)) +
  geom_col(fill = "cadetblue3") +
  scale_x_continuous(breaks = 1999:2012) +
  scale_y_continuous(breaks = seq(0, 150, by = 25)) +
  labs(x = "\nYear", y = "Number of juvenile hare trappings\n") +
  theme_bw()
```

**Figure 1:** Total number of juvenile hare trappings by year (1999-2012).

The data shows that total juvenile hare trappings varied considerably by year, with the most trapped in 1999, and a general decrease in hares trapped over the course of the study. In some year, no juvenile hares were trapped -- 1998 (not shown), 2002, and 2009. The minimum juvenile hare count (> 1) was `r hare_count_stats[3]` and the maximum juvenile hare count was `r hare_count_stats[2]`. The mean number of juvenile hares trapped annually is `r hare_count_stats[1]`, and the median is `r hare_count_stats[4]`. To standardize the juvenile hare population in future analyses, I would recommend calculating the number of juveniles hares trapped per number of traps placed per year. This would eliminate the effect of effort on the counts and make the count value intensive, not relying on the amount of each year's effort.

### Visualize juvenile hare weights by sex and grid

```{r, include = FALSE}

# Wrangle juvenile hare weights and add new dolumn wiuth full grid names
juve_hares <- bonanza_hares %>%
  filter(age == "j") %>%
    mutate(grid_full = case_when(
    grid == "bonrip" ~ "Bonanza Riparian",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonbs" ~ "Mature Lowland Black Spruce")) %>%
  drop_na(weight) 
```

```{r, include = TRUE}

# Visualize juvenile hare weights
juve_hares %>%
  ggplot(aes(x = sex, y = weight)) +
  geom_jitter(aes(color = sex)) + 
  scale_color_manual(values = c("lightcoral", "darkseagreen3", "grey")) +
  geom_boxplot(alpha = 0.7, fill = NA) +
  facet_wrap(~ grid_full) +
  scale_y_continuous(breaks = seq(0, 1800, by = 200)) +
  stat_summary(fun.y = mean, geom = "point", shape = 20, size = 4 , color = "black") + 
  theme_bw() +
  labs(x = "\nSex", y = "Juvenile hare weight (grams)\n") +
  theme(legend.position = "none") +
  scale_x_discrete(labels = c("Female","Male","Unknown"))
```

**Figure 2:** Juvenile hare weights (g) by sex and by site. Each point is a single observation. The overlaying box plot shows the median (line), interquartile range (box), minimum and maximum (whiskers), and outliers (points beyond whiskers). The larger black dots indicate the mean for each sex category at each site. 

The most juvenile hares were trapped at the Bonanza Riparian site, which may indicated their preferred habitat. The mean and median weights do vary by sex, although not dramatically, and can be compared by looking across the black points and lines. Males and female weights appear to have similar means in the Bonanza Mature and Bonanza Riparian zones, while in the Mature Lowland Black Spruce site, the means appear to be larger for each sex. 

### Juvenile weight comparison by sex

```{r, include = FALSE}

# Visualize data exploration with histograms and Q-Q plots
ggplot(data = juve_hares, aes(x = weight)) +
  geom_histogram(bins = 15) +
  facet_wrap(~ sex)

ggplot(data = juve_hares, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex)

# Data appears normally distributed
```

```{r, include = FALSE}

# Split into groups for t-test
female_sample <- juve_hares %>% 
  filter(sex == "f") %>% 
  drop_na(weight) %>%
  pull(weight)

male_sample <- juve_hares %>% 
  filter(sex == "m") %>% 
  drop_na(weight) %>%
  pull(weight)
```

```{r, include = FALSE}
# Perform t-test

weight_t <- t.test(male_sample, female_sample)

weight_t_tidy <- tidy(weight_t)

weight_t_tidy
```

```{r, include = FALSE}
# Cohen's d

weight_cohen <- cohen.d(male_sample, female_sample)

weight_cohen
```

```{r, include = FALSE}
# Summary statistics for weights

weight_stats <- juve_hares %>%
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male")) %>%
  group_by(sex) %>%
  drop_na(sex) %>%
  summarize(mean = round(mean(weight, na.rm = TRUE), 2),
            sd = round(sd(weight, na.rm = TRUE), 2),
            sample_size = n())
```

```{r, include = TRUE}

# Create table
  kbl(weight_stats, caption = "<center><strong>Table 1: Means comparison of male and female juvenile snowshoe hare weights. </strong>: The mean male hare weight is larger than the female mean weight. The male mean weight also has a larger standard deviation but a smaller sample size.</center>", col.names = c("Sex", "Mean (g)", "Standard Deviation (g)", "Sample Size")) %>%
  kable_paper() %>%
  kable_styling(bootstrap_options = c("striped", "hover")) 
```
The male mean weight (`r weight_stats$mean[2]`) is `r weight_stats$mean[2] - weight_stats$mean[1]` larger than the female mean weight (`r weight_stats$mean[1]`). The effect size is small (`r round(weight_cohen$estimate, 2)`) and the differene significant (two-sample t-test: t = `r round(weight_t_tidy[4], 2)`, p < `r round(weight_t_tidy[5], 3)`).

### Relationship between juvenile weight & hind foot length

```{r, include = TRUE}

# Compare juvenile hare hind foot length and weight
juve_hares %>%
  ggplot(aes(x = weight, y = hindft)) +
  geom_point(color = "cadetblue3") +
  scale_x_continuous(breaks = seq(0,1800, by = 200)) +
  scale_y_continuous(breaks = seq(60,160, by = 20)) +
  labs(x = "\nJuvenile hare weight (grams)", y = "Hind foot length (mm)\n") +
  theme_bw() +
  geom_smooth(method = lm)
```

**Figure 3:** Juvenile hind foot length (mm) v. hare weight (g) correlation. There is a positive correlation between hind foot length and juvenile hare weight. The plotted line is a linear regression model.

```{r, include = FALSE}

# Linear regression
hare_lm <- lm(weight ~ hindft, data = juve_hares)

hare_lm_tidy <- tidy(hare_lm)

hare_lm_tidy
```

```{r, include = FALSE}

# Glance to see R^2
hare_lm_out <- glance(hare_lm)

hare_lm_out
```

```{r, include = FALSE}

# Pearson's r
hares_cor <- cor.test(juve_hares$weight, juve_hares$hindft)

hares_cor_tidy <- tidy(hares_cor)

hares_cor_tidy
```

```{r, include = FALSE}

# Check model diagnostics
plot(hare_lm)
```

There is a medium positive correlation (Pearson's r = `r round(hares_cor_tidy[1], 2)`) between juvenile hare weight and hind foot length. R^2 = `r round(hare_lm_out[1],3)`, which indicates that 29.9% of the variance in juvenile hare hind foot length is explained by the model for juvenile hare weight. The diagnostic plots of the model do pose a concern. Based on the residual variances plot, the assumption of homoscedasticity is violated. The q-q-plot also poses converns about the normality of the residuals distribution because it appears skewed. Additionally, the Cook's distance plot shows some outliers that may be influencing the model. Because of the low R^2 value and the abnormal diagnostic plots, I would not say that this linear model describes the relationship very well.

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

## Summary

Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)

## Citations

**Data citation:** Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

